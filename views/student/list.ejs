<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
  <h1 class="h2">Danh sách học sinh</h1>
  <div class="btn-toolbar mb-2 mb-md-0">
    <a href="/students/create" class="btn btn-sm btn-primary">
      <i class="bi bi-plus-circle"></i> Thêm học sinh
    </a>
  </div>
</div>

<div class="row mb-3">
  <div class="col-md-12">
    <form action="/students" method="GET" class="row g-3">
      <div class="col-md-3">
        <input type="text" class="form-control" name="search" placeholder="Tìm kiếm theo tên, mã HS" value="<%= search || '' %>">
      </div>
      <div class="col-md-2">
        <select class="form-select" name="grade">
          <option value="">Tất cả khối</option>
          <option value="10">Khối 10</option>
          <option value="11">Khối 11</option>
          <option value="12">Khối 12</option>
        </select>
      </div>
      <div class="col-md-2">
        <select class="form-select" name="status">
          <option value="">Tất cả trạng thái</option>
          <option value="Đang học">Đang học</option>
          <option value="Bảo lưu">Bảo lưu</option>
          <option value="Thôi học">Thôi học</option>
        </select>
      </div>
      <div class="col-md-2">
        <button type="submit" class="btn btn-primary">
          <i class="bi bi-search"></i> Tìm kiếm
        </button>
      </div>
    </form>
  </div>
</div>

<div class="table-responsive">
  <table class="table table-striped table-hover">
    <thead>
      <tr>
        <th>Mã HS</th>
        <th>Họ tên</th>
        <th>Ngày sinh</th>
        <th>Giới tính</th>
        <th>Lớp</th>
        <th>Trạng thái</th>
        <th>Thao tác</th>
      </tr>
    </thead>
    <tbody>
      <% if (students && students.length > 0) { %>
        <% students.forEach(student => { %>
          <tr>
            <td><%= student.studentCode %></td>
            <td><%= student.fullName %></td>
            <td><%= new Date(student.dateOfBirth).toLocaleDateString('vi-VN') %></td>
            <td><%= student.gender %></td>
            <td><%= student.currentClass ? student.currentClass.className : 'Chưa phân lớp' %></td>
            <td>
              <span class="badge bg-<%= student.status === 'Đang học' ? 'success' : 'secondary' %>">
                <%= student.status %>
              </span>
            </td>
            <td>
              <a href="/students/<%= student._id %>" class="btn btn-sm btn-info">
                <i class="bi bi-eye"></i>
              </a>
              <a href="/students/<%= student._id %>/edit" class="btn btn-sm btn-warning">
                <i class="bi bi-pencil"></i>
              </a>
              <button class="btn btn-sm btn-danger" onclick="deleteStudent('<%= student._id %>')">
                <i class="bi bi-trash"></i>
              </button>
            </td>
          </tr>
        <% }); %>
      <% } else { %>
        <tr>
          <td colspan="7" class="text-center">Không có dữ liệu</td>
        </tr>
      <% } %>
    </tbody>
  </table>
</div>

<script>
function deleteStudent(id) {
  if (confirm('Bạn có chắc chắn muốn xóa học sinh này?')) {
    fetch(`/students/${id}`, {
      method: 'DELETE',
      headers: {
        'Content-Type': 'application/json',
      }
    })
    .then(response => response.json())
    .then(data => {
      if (data.success) {
        alert('Xóa học sinh thành công');
        window.location.reload();
      } else {
        alert('Lỗi: ' + data.message);
      }
    });
  }
}
</script>
