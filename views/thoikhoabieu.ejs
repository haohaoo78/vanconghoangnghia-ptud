<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Quản lý Thời Khóa Biểu</title>
<style>
body{font-family:Arial;margin:20px;}
h2{color:#2a9d8f;}
.controls{display:flex;gap:12px;flex-wrap:wrap;margin-bottom:10px;}
label{font-size:14px;}
table{border-collapse:collapse;width:100%;margin-bottom:10px;}
th,td{border:1px solid #ccc;padding:6px;text-align:center;vertical-align:middle;}
th{background:#f4a261;color:white;}
select,input{width:100%;box-sizing:border-box;}
.btn{padding:6px 12px;margin:5px;cursor:pointer;background:#2a9d8f;color:white;border:none;border-radius:4px;}
.note{font-size:13px;color:#444;margin-bottom:12px;}
.info{margin-top:8px;color:#085e5c;font-weight:600;}
.teacher{display:block;margin-top:4px;font-size:12px;color:#333;}
.teacher.missing{color:#d62828;}
</style>
</head>
<body>
<h2>Quản lý Thời Khóa Biểu</h2>

<div class="controls">
<form id="filter-form">
  <label>Khối:
    <select id="Khoi" name="Khoi" required>
      <option value="">--Chọn khối--</option>
      <% khoiList.forEach(k => { %>
        <option value="<%= k.MaKhoi %>" <%= k.MaKhoi===selectedKhoi?'selected':'' %>><%= k.TenKhoi %></option>
      <% }) %>
    </select>
  </label>

  <label>Lớp:
    <select name="MaLop" id="MaLop" required>
      <option value="">--Chọn lớp--</option>
      <% classes.forEach(c => { %>
        <option value="<%= c.MaLop %>" <%= c.MaLop===selectedClass?'selected':'' %>><%= c.TenLop %></option>
      <% }) %>
    </select>
  </label>

  <label>Năm học:
    <select name="NamHoc" id="NamHoc">
      <% namHocList.forEach(nh=>{ %>
        <option value="<%= nh %>" <%= nh===selectedNamHoc?'selected':'' %>><%= nh %></option>
      <% }) %>
    </select>
  </label>

  <label>Học kỳ:
    <select name="KyHoc" id="KyHoc">
      <% kyHocList.forEach(ky => { %>
        <option value="<%= ky %>" <%= ky===selectedKyHoc?'selected':'' %>><%= ky %></option>
      <% }) %>
    </select>
  </label>

  <label>Tuần:
    <select name="LoaiTKB" id="LoaiTKB">
      <option value="Chuan" <%= selectedLoaiTKB==='Chuan'?'selected':'' %>>TKB chuẩn</option>
      <% for(let w=1; w<=20; w++){ %>
        <option value="Tuan<%= w %>" <%= selectedLoaiTKB==='Tuan'+w?'selected':'' %>>Tuần <%= w %></option>
      <% } %>
    </select>
  </label>

  <input type="hidden" id="NamHocStart" name="NamHocStart" value="<%= selectedNamHocStart %>">

  <button class="btn" type="submit">Hiển thị</button>
  <button class="btn" type="button" id="reset-week">Reset về TKB chuẩn</button>
</form>
</div>

<div class="note">Chú ý: Chọn "TKB chuẩn" hoặc tuần cụ thể để chỉnh sửa.</div>
<div id="status" class="info"><%= statusMessage || 'Chưa có dữ liệu' %></div>

<div id="timetable-container">
<form id="timetable-form">
<table id="timetable-table"></table>
<button type="button" id="save-timetable">Lưu TKB</button>
</form>
</div>
<script src="/js/ThoiKhoaBieu.js"></script>
</body>
</html>
